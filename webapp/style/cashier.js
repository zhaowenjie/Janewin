var Chart = {
	browserData: {"status":0,"msg":"","data":{"fields":["custom_visit_title","visit_count","avg_visit_pages","session_avg_visit_time","new_visitor_ratio","session_bounce_ratio"],"total":36,"sum":[[297,2.33,376,25.76,58.25],[]],"pageSum":[[297,2.33,376,25.76,58.25],[],[]],"items":[[[{"id":"7452260766563547560","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/45.0.2454.101 Safari\/537.36"}],[{"id":"7450220047213307141","label":"Mozilla\/5.0 (Windows NT 6.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/38.0.2125.101 Safari\/537.36"}],[{"id":"6894281446161312903","label":"Mozilla\/5.0 (Windows NT 6.1; rv:43.0) Gecko\/20100101 Firefox\/43.0"}],[{"id":"6686537066577835455","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/45.0.2454.101 Safari\/537.36"}],[{"id":"11723781222738489567","label":"Mozilla\/5.0 (Windows NT 6.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/38.0.2125.122 Safari\/537.36 SE 2.X MetaSr 1.0"}],[{"id":"7459474662367130751","label":"Mozilla\/5.0 (Windows NT 6.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/45.0.2454.101 Safari\/537.36"}],[{"id":"5809705255164182163","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.108 Safari\/537.36 2345Explorer\/8.0.0.13547"}],[{"id":"6815960232434214793","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64; rv:48.0) Gecko\/20100101 Firefox\/48.0"}],[{"id":"7357546738968745161","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/50.0.2661.102 Safari\/537.36"}],[{"id":"12328698071491871162","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64; Trident\/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2; .NET4.0C; rv:11.0) like Gecko"}],[{"id":"17023085548301466239","label":"Mozilla\/5.0 (Windows NT 6.3; WOW64; Trident\/7.0; Touch; .NET4.0E; .NET4.0C; .NET CLR 3.5.30729; .NET CLR 2.0.50727; .NET CLR 3.0.30729; Tablet PC 2.0; InfoPath.3; Shuame; GWX:DOWNLOADED; GWX:RESERVED; ASU2JS; rv:11.0) like Gecko"}],[{"id":"9584127665505878768","label":"Mozilla\/5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko\/20100101 Firefox\/47.0"}],[{"id":"6887437129757720461","label":"Mozilla\/5.0 (Windows NT 6.3; WOW64; rv:49.0) Gecko\/20100101 Firefox\/49.0"}],[{"id":"13559149819190485248","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64; Trident\/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; rv:11.0) like Gecko"}],[{"id":"5737662156574916179","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.108 Safari\/537.36 2345Explorer\/7.1.0.12633"}],[{"id":"7375076515895442800","label":"Mozilla\/5.0 (Windows NT 10.0; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/51.0.2704.106 Safari\/537.36"}],[{"id":"15913212457591911807","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64; Trident\/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2; rv:11.0) like Gecko"}],[{"id":"7315376936331857362","label":"Mozilla\/5.0 (Windows NT 5.1; rv:48.0) Gecko\/20100101 Firefox\/48.0"}],[{"id":"7322590832135440553","label":"Mozilla\/5.0 (Windows NT 6.1; rv:48.0) Gecko\/20100101 Firefox\/48.0"}],[{"id":"2101543180193955761","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.80 Safari\/537.36 Core\/1.47.933.400 QQBrowser\/9.4.8699.400"}],[{"id":"7236928954940615023","label":"Mozilla\/5.0 (Windows NT 6.1; rv:47.0) Gecko\/20100101 Firefox\/47.0"}],[{"id":"7401038813526682892","label":"Mozilla\/5.0 (Windows NT 5.1; rv:49.0) Gecko\/20100101 Firefox\/49.0"}],[{"id":"5403749802646916998","label":"Mozilla\/5.0 (Windows NT 10.0; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.108 Safari\/537.36 2345Explorer\/8.1.0.13750"}],[{"id":"4647565018980007011","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/31.0.1650.63 Safari\/537.36"}],[{"id":"9608361962663977186","label":"Mozilla\/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko\/20100101 Firefox\/48.0"}],[{"id":"805814573486642794","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.80 Safari\/537.36 Core\/1.47.933.400 QQBrowser\/9.4.8699.400"}],[{"id":"6887268054045140185","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64; rv:49.0) Gecko\/20100101 Firefox\/49.0"}],[{"id":"4552598089099945130","label":"Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/50.0.2661.95 Safari\/537.36 Core\/1.50.1563.400 QQBrowser\/9.5.9430.400"}],[{"id":"6686706142290415731","label":"Mozilla\/5.0 (Windows NT 6.3; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/45.0.2454.101 Safari\/537.36"}],[{"id":"7408252709330266083","label":"Mozilla\/5.0 (Windows NT 6.1; rv:49.0) Gecko\/20100101 Firefox\/49.0"}],[{"id":"2336752669388228407","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/50.0.2661.102 UBrowser\/5.7.15897.14 Safari\/537.36"}],[{"id":"100972008221100432","label":"Mozilla\/5.0 (Windows NT 6.3; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/49.0.2623.22 Safari\/537.36 SE 2.X MetaSr 1.0"}],[{"id":"4486048075050288135","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Maxthon\/4.9.3.1000 Chrome\/39.0.2146.0 Safari\/537.36"}],[{"id":"10139374443499334345","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/39.0.2171.95 Safari\/537.36 MicroMessenger\/6.5.2.501 NetType\/WIFI WindowsWechat"}],[{"id":"7646219115611967337","label":"Mozilla\/5.0 (Windows NT 10.0; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.106 Safari\/537.36"}],[{"id":"583664562594633191","label":"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/47.0.2526.80 Safari\/537.36 Core\/1.47.640.400 QQBrowser\/9.4.8309.400"}]],[[74,1.5,227,19.35,71.62],[35,4.14,263,7.14,22.86],[29,3.03,491,5,44.83],[20,1.75,372,17.65,70],[16,1.38,425,18.18,68.75],[16,1.38,350,40,68.75],[12,1.83,164,100,41.67],[11,1.36,176,14.29,81.82],[9,1,343,0,100],[8,1.25,157,14.29,75],[8,1.63,292,16.67,75],[8,3.13,1031,0,25],[5,5.6,849,0,20],[5,2.6,438,33.33,40],[5,2,972,100,40],[3,3.33,387,66.67,66.67],[3,1.67,293,100,33.33],[3,1.33,189,66.67,66.67],[3,1,67,50,100],[3,1,120,33.33,100],[2,1,120,100,100],[2,1,26,0,100],[2,20,1389,100,0],[2,1,317,100,100],[2,11.5,3024,0,0],[1,4,550,100,0],[1,3,2721,0,0],[1,1,120,0,100],[1,1,218,100,100],[1,1,120,0,100],[1,4,1436,0,0],[1,2,221,100,0],[1,8,1044,0,0],[1,2,1187,100,0],[1,3,715,100,0],[1,1,120,100,100]],[],[]],"title":"browser"}},
	init: function(){

		this.initBrowser(this.browserData);
	},
	initBrowser: function(data){

		var data = this.getBrowserData(data);

		var systemData = this.formatSystemData(data);
		var browserData = this.formatBrowserData(data);

		this.renderSystemChart(systemData);
		this.renderBrowserChart(browserData);
	},
	formatSystemData: function(data){

		var obj = {
			win7: 0,
			win8: 0,
			winXP: 0,
			win10: 0,
			MAC: 0,
			other: 0
		};

		for(var i=0;i<data.length;i++){

			var label = data[i].label;
			
			if(/Windows NT 5.1/.test(label)){
				obj.winXP += data[i].pv;
			}else if(/Windows NT 6.1/.test(label)){
				obj.win7 += data[i].pv;
			}else if(/Windows NT 6.2/.test(label)||/Windows NT 6.3/.test(label)){
				obj.win8 += data[i].pv;
			}else if(/Windows NT 6.4/.test(label)||/Windows NT 10.0/.test(label)){
				obj.win10 += data[i].pv;
			}else if(/Mac OS X/.test(label)){
				obj.MAC += data[i].pv;
			}else{
				console.warn(label);
				obj.other += data[i].pv;
			}
		}
		return obj;
	},
	formatBrowserData: function(data){
		this.getBrowserVersion(data);
		var obj = {
			IE: 0,
			firefox: 0,
			chrome: 0,
			opera: 0,
			Safari: 0,
			other: 0
		};
		for(var i=0;i<data.length;i++){

			var label = data[i].label;
			console.info(label);
			if(/(msie\s|trident.*rv:)([\w.]+)/.test(label)||/Trident\/7.0/.test(label)){
				// ie11 Trident\/7.0  http://www.xpc8.com/xitong/vista_win_7/vista_win_7_3887.html
				obj.IE += data[i].pv;
			}else if(/(Firefox)\/([\w.]+)/.test(label)){
				obj.firefox += data[i].pv;
			}else if(/(opera).+version\/([\w.]+)/.test(label)){
				obj.opera += data[i].pv;
			}else if(/Version\/([\w.]+).*(Safari)/.test(label)){
				obj.Safari += data[i].pv;
			}else if(/(Chrome)\/([\w.]+)/.test(label)){
				obj.chrome += data[i].pv;
			}else{
				console.warn(label);
				obj.other += data[i].pv;
			}
		}
		return obj;
	},
	getBrowserVersion: function(data){
		var obj = {
			'IE浏览器': 0,
			'2345浏览器':0,
			'QQ浏览器':0,
			'火狐浏览器': 0,
			'搜狗浏览器': 0,
			'UC浏览器': 0,
			chrome: 0,
			opera: 0,
			Safari: 0,
			other: 0
		};
		for(var i=0;i<data.length;i++){
			// navigator.userAgent
			// http://www.bubuko.com/infodetail-535021.html
			var label = data[i].label;
			if(/(msie\s|trident.*rv:)([\w.]+)/.test(label)||/Trident\/7.0/.test(label)){
				// ie11 Trident\/7.0  http://www.xpc8.com/xitong/vista_win_7/vista_win_7_3887.html
				obj['IE浏览器'] += data[i].pv;
			}else if(/QQBrowser\/\d{1,2}\./.test(label)){
			
				obj['QQ浏览器'] += data[i].pv;
			}else if(/MetaSr/.test(label)){
			
				obj['搜狗浏览器'] += data[i].pv;
			}else if(/UBrowser/.test(label)){
			
				obj['UC浏览器'] += data[i].pv;
			}else if(/2345Explorer\/\d{1,2}\./.test(label)){
			
				obj['2345浏览器'] += data[i].pv;
			}else if(/(Firefox)\/([\w.]+)/.test(label)){
			
				obj['火狐浏览器'] += data[i].pv;
			}else if(/(opera).+version\/([\w.]+)/.test(label)){
			
				obj.opera += data[i].pv;
			}else if(/Version\/([\w.]+).*(Safari)/.test(label)){
			
				obj.Safari += data[i].pv;
			}else if(/(Chrome)\/([\w.]+)/.test(label)){
			
				obj.chrome += data[i].pv;
			}else{
				console.warn(label);
				obj.other += data[i].pv;
			}
		}

		this.renderChainBrowserChart(obj);
		console.warn(obj);
	},
	renderChainBrowserChart: function(data){

		var browserOption = {
			title: {
				text: "各个浏览器访问量",
				padding: 5,
				itemGap: 0
			},
			tooltip: {
				trigger: "axis"
			},
			legend: {
				data: ["各个浏览器访问量"]
			},
			toolbox: {
				show: true,
				feature: {
					dataView: {
						show: true,
						readOnly: true
					},
					magicType: {
						show: false,
						type: ["line", "bar"]
					},
					saveAsImage: {
						show: true
					}
				}
			},
			calculable: true,
			xAxis: [
				{
					type: "category",
					data: ["chrome", "火狐浏览器", "IE浏览器", "2345浏览器", "搜狗浏览器", "QQ浏览器", "其他"],
					name: "月份",
					nameLocation: "end",
					nameTextStyle: {
						color: "rgb(0, 0, 0)"
					}
				}
			],
			yAxis: [
				{
					type: "value",
					nameTextStyle: {
						color: "rgb(0, 0, 0)"
					},
					name: "收益 / 元",
					nameLocation: "end"
				}
			],
			series: [
				{
					name: "各个浏览器访问量",
					type: "bar",
					data: [data["chrome"], data["火狐浏览器"], data["IE浏览器"], data["2345浏览器"], data["搜狗浏览器"], data["QQ浏览器"], data["other"]],
					markPoint: {
						data: [
							{
								name: "年最高",
								value: 182.2,
								xAxis: 7,
								yAxis: 183,
								symbolSize: 18
							},
							{
								name: "年最低",
								value: 2.3,
								xAxis: 11,
								yAxis: 3
							}
						]
					},
					markLine: {
						data: [
							{
								type: "average",
								name: "平均值"
							}
						]
					},
					barWidth: 30,
					barCategoryGap: "0%",
					itemStyle: {
						normal: {
							borderRadius: 4
						}
					}
				}
			],
			grid: {
				width: '90%',
				x: '5%',
				x2: '5%'
			},
			color: ["rgb(255, 152, 2)", "rgb(89, 201, 200)", "#da70d6", "#32cd32", "#6495ed", "#ff69b4", "#ba55d3", "#cd5c5c", "#ffa500", "#40e0d0", "#1e90ff", "#ff6347", "#7b68ee", "#00fa9a", "#ffd700", "#6699FF", "#ff6666", "#3cb371", "#b8860b", "#30e0e0", "#FFFFFF"]
		}

		var myChart = echarts.init(document.getElementById('chain-browser-chart-body'));

		myChart.setOption(browserOption);
	},
	getBrowserData: function(data){

		var items = data.data.items
		var pvData = items[1];
		var obj = [];

		for(var i=0; i < items[0].length;i++){

			obj.push({
				label:items[0][i][0].label,
				index: i 
			})

			obj[i].pv = pvData[i][0];
		}
		return obj;
	},
	renderSystemChart:function(data){

		var arr1 = [],arr2 = [];

		for(var k in data){

			// if(data[k] == 0){continue;};
			arr1.push(k);
			arr2.push({
				value:data[k], name:k
			});
		}

		var browserOption = {
			title : {
				text: '用户操纵系统统计',
				subtext: '不完全统计',
				x:'center'
			},
			tooltip : {
				trigger: 'item',
				formatter: "{a} <br/>{b} : {c} ({d}%)"
			},
			legend: {
				orient: 'vertical',
				left: 'left',
				data: arr1
			},
			series : [
				{
					name: '访问来源',
					type: 'pie',
					radius : '55%',
					center: ['50%', '60%'],
					data:arr2,
					itemStyle: {
						emphasis: {
							shadowBlur: 10,
							shadowOffsetX: 0,
							shadowColor: 'rgba(0, 0, 0, 0.5)'
						}
					}
				}
			]
		};

		var myChart = echarts.init(document.getElementById('system-chart-body'));

		myChart.setOption(browserOption);
	},

	renderBrowserChart: function(data){
		var arr1 = [],arr2 = [];

		for(var k in data){

			if(data[k] == 0){continue;};
			arr1.push(k);
			arr2.push({
				value:data[k], name:k
			});
		}

		var browserOption = {
			title : {
				text: '用户浏览器内核版本统计',
				subtext: '不完全统计',
				x:'center'
			},
			tooltip : {
				trigger: 'item',
				formatter: "{a} <br/>{b} : {c} ({d}%)"
			},
			legend: {
				orient: 'vertical',
				left: 'left',
				data: arr1
			},
			series : [
				{
					name: '访问来源',
					type: 'pie',
					radius : '55%',
					center: ['50%', '60%'],
					data:arr2,
					itemStyle: {
						emphasis: {
							shadowBlur: 10,
							shadowOffsetX: 0,
							shadowColor: 'rgba(0, 0, 0, 0.5)'
						}
					}
				}
			]
		};

		var myChart = echarts.init(document.getElementById('browser-chart-body'));

		myChart.setOption(browserOption);
	}
};
Chart.areaMap = {
	// 地域map
	data:{"status":0,"msg":"","data":{"fields":["simple_district_title","pv_count","ratio"],"items":[[["\u4e0a\u6d77"],["\u5e7f\u4e1c"],["\u56db\u5ddd"],["\u6cb3\u5357"],["\u5c71\u4e1c"],["\u5b89\u5fbd"],["\u4e91\u5357"],["\u6cb3\u5317"],["\u5c71\u897f"],["\u5176\u4f59\u5730\u533a"],["\u5e7f\u897f"],["\u5185\u8499\u53e4"],["\u65b0\u7586"],["\u5317\u4eac"],["\u6d59\u6c5f"],["\u6e56\u5357"],["\u6c5f\u82cf"]],[[125,27.35],[72,15.75],[45,9.85],[37,8.1],[31,6.78],[31,6.78],[24,5.25],[24,5.25],[19,4.16],[49,10.72],[11,2.41],[10,2.19],[9,1.97],[5,1.09],[4,0.88],[4,0.88],[2,0.44]]]}},
	init: function(){
		
		this.getData();
	},
	getData: function(){
		var items = this.data.data.items;
		var provinceList =  items[0];
		var dataList =  items[1];
		console.log(provinceList);
		console.log(dataList);
		var datas  = []; 
		for(var i = 0;i<provinceList.length;i++){
			if(provinceList[i][0]=='上海'){
				this.max = dataList[i][0];
			}
			datas.push({value: dataList[i][0],name: provinceList[i][0]});
		}
		this.renderChart(datas);
	},
	renderChart:function(datas){

		var me = this;
		// unescape('\u5e7f\u4e1c')
		var option = {
			title: {
				text: "客户访问量地域统计",
				subtext: "不完全统计",
				x: "center"
			},
			tooltip: {
				trigger: "item",
				show: true,
				formatter: '访问量<br>{b}：{c}'
			},
			legend: {
				orient: "vertical",
				x: "left",
				data: ["访问量"]
			},
			dataRange: {
				min: 0,
				max: me.max,
				x: "left",
				y: "bottom",
				text: ["高", "低"],
				calculable: true,
				color: ["#006edd", "#e0ffff"]
			},
			toolbox: {
				show: true,
				orient: "vertical",
				x: "right",
				y: "bottom",
				feature: {
					dataView: {
						readOnly: false
					},
					saveAsImage: {
						show: true
					}
				}
			},
			roamController: {
				mapTypeControl: {
					china: true
				},
				x: "right",
				show: true,
				step: 15
			},
			series: [
				{
					name: "访问量",
					type: "map",
					mapType: "china",
					roam: false,
					mapValueCalculation: "sum",
					itemStyle: {
						emphasis: {
							label: {
								show: true
							}
						}
					},
					data: datas,
					showLegendSymbol: false
				}
			]
		}
		var myChart = echarts.init(document.getElementById('area-chart-body'));
		$.get('/js/json/china.json', function (chinaJson) {
			console.log(chinaJson);
			echarts.registerMap('china', chinaJson);
			myChart.setOption({
				series: [{
					type: 'map',
					map: 'china'
				}]
			});
			myChart.setOption(option);
		});
	}
}

Chart.init();
Chart.areaMap.init();